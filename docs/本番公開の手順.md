# 世に出すために必要なこと（本番公開）

## 全体像

| 役割 | 今（開発） | 本番でやること |
|------|------------|----------------|
| **バックエンド** | 自分のPCで `uvicorn` | **クラウドにデプロイ**（APIのURLが変わる） |
| **フロントエンド** | `flutter run -d chrome` | **Webとしてビルドしてホスティング**（またはアプリストア） |
| **APIキー** | `.env` に直書き | **本番用のシークレット**で管理（サービス側の環境変数） |
| **通信** | localhost | **HTTPS** + **CORS** を本番ドメインに制限 |

---

## 1. バックエンドを「どこか」にデプロイする

FastAPI を 24 時間動かすサーバーが必要です。例（いずれか1つでOK）:

- **Railway** … 無料枠あり、デプロイが簡単。GitHub 連携で push すると自動デプロイ。
- **Render** … 無料枠あり。Web Service で「Docker または Python」を選べる。
- **Fly.io** … 無料枠あり。CLI でデプロイ。
- **Google Cloud Run / AWS / Azure** … 本格運用向け。

**やることの例（Railway）:**

1. [railway.app](https://railway.app) で GitHub 連携し、このリポジトリを選択。
2. ルートではなく **`backend` をサービスとしてデプロイ**（または backend だけのリポジトリにする）。
3. 環境変数に **ANTHROPIC_API_KEY** を設定（ダッシュボードの Variables）。
4. デプロイ後に **https://xxxx.up.railway.app** のような URL が発行される → これが「本番の API の URL」。

**共通で必要なこと:**

- `requirements.txt` があるので「Python プロジェクト」としてビルド。
- 起動コマンド例: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`（Render / Railway は `PORT` を渡すことが多い）。
- **API キーは絶対にコードに書かず、サービスの「環境変数」だけに設定する。**

---

## 2. フロントエンドを「本番 API URL」に向ける

今は `http://localhost:8000` 固定なので、本番では **デプロイした API の URL** に変える必要があります。

- このリポジトリでは **ビルド時に URL を渡す**方式を用意する（下記「本番ビルド」参照）。
- または環境別に `lib/config.dart` のようなファイルを切り替えてもよい。

**本番用にビルドするとき（API URL を指定）:**

```bash
cd frontend
flutter build web --dart-define=API_BASE_URL=https://あなたのAPIのURL
```

例: バックエンドが `https://youtube-summarizer.up.railway.app` なら:

```bash
flutter build web --dart-define=API_BASE_URL=https://youtube-summarizer.up.railway.app
```

出力は `build/web/` に入るので、このフォルダをそのままホスティングにアップロードする。

**Flutter Web をホスティングする例:**

- **Firebase Hosting** … `build/web` を `firebase deploy`。
- **Vercel / Netlify** … 同様に `build/web` をデプロイ。
- **GitHub Pages** … 静的サイトとして `build/web` を公開。

---

## 3. 本番で直すべき設定（セキュリティ）

1. **CORS**  
   `main.py` の `allow_origins=["*"]` は開発用。本番では **フロントを置くドメインだけ**に絞る。  
   例: `allow_origins=["https://あなたのアプリのドメイン.com"]`

2. **API キー**  
   - 本番用に **新しいキーを発行**し、開発で使ったキーは無効化。  
   - 本番のキーは **ホスティング先の環境変数だけ**に設定し、Git にコミットしない。

3. **レート制限（推奨）**  
   誰でも API を叩けると悪用・高額請求のリスクがあるため、  
   - 同一IPやユーザーごとの **リクエスト数制限**、  
   - または **認証（APIキー・ログイン）** を検討する。

---

## 4. チェックリスト（世に出す前に）

- [ ] バックエンドをクラウドにデプロイし、HTTPS の URL が取れている
- [ ] 本番用 **ANTHROPIC_API_KEY** を発行し、デプロイ先の環境変数にだけ設定
- [ ] フロントの API のベース URL を本番 URL に変更してビルド
- [ ] フロントを Web ホスティングにデプロイ
- [ ] CORS を本番フロントのオリジンだけに制限
- [ ] （任意）独自ドメイン・HTTPS・エラーログの確認

---

## 5. まとめ

「世に出す」＝  
**バックエンドをクラウドで動かす** → **フロントをその API の URL でビルドして Web で公開する** → **CORS と API キーを本番向けに絞る**、の3つが中心です。

まずは **バックエンドを Railway か Render にデプロイ** → **発行された URL をフロントに設定して `flutter build web`** → **Firebase か Vercel にデプロイ**、という順で進めるとやりやすいです。
